<div class="flex h-screen bg-gray-900 text-gray-200 font-sans">

  <!-- Mobile Off-canvas Sidebar -->
  <div class="lg:hidden">
    <!-- Backdrop -->
    @if (isMobileMenuOpen()) {
      <div (click)="toggleMobileMenu()" class="fixed inset-0 bg-black/60 z-30"></div>
    }
    <!-- Sidebar Panel -->
    <aside 
      class="fixed inset-y-0 left-0 w-64 bg-gray-800 text-gray-200 transform transition-transform duration-300 ease-in-out z-40 flex flex-col"
      [class]="isMobileMenuOpen() ? 'translate-x-0' : '-translate-x-full'">
      
      <div class="flex items-center justify-center h-20 border-b border-gray-700 shrink-0">
        <h1 class="text-2xl font-bold text-emerald-400">AgroSys</h1>
      </div>
      
      <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
        @for (module of modules; track module.id) {
          @if (module.children) {
            <div>
              <button (click)="toggleSubmenu(module.id)" class="w-full flex items-center justify-between p-2.5 rounded-lg hover:bg-gray-700 transition-colors duration-200">
                <span class="font-medium">{{ module.name }}</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform duration-300" [class]="openSubmenuIds()[module.id] ? 'rotate-90' : ''" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                </svg>
              </button>
              <div class="overflow-hidden transition-all duration-300 ease-in-out" [style.max-height.px]="openSubmenuIds()[module.id] ? 1500 : 0">
                <ul class="pt-1 pl-4 space-y-1">
                  @for(submodule of module.children; track submodule.id) {
                    <li>
                      <a (click)="selectModule(submodule.id, !submodule.children)" [class]="'block p-2 rounded-md cursor-pointer transition-colors duration-200 ' + (selectedModuleId() === submodule.id ? 'bg-emerald-500 text-white' : 'hover:bg-gray-700')">
                        {{ submodule.name }}
                      </a>
                    </li>
                  }
                </ul>
              </div>
            </div>
          } @else {
            <a (click)="selectModule(module.id, true)" [class]="'block p-2.5 rounded-lg cursor-pointer transition-colors duration-200 ' + (selectedModuleId() === module.id ? 'bg-emerald-500 text-white' : 'hover:bg-gray-700')">
              <span class="font-medium">{{ module.name }}</span>
            </a>
          }
        }
      </nav>
    </aside>
  </div>

  <!-- Desktop Sidebar (Contextual) -->
  <aside 
    class="hidden lg:flex flex-col bg-gray-800 text-gray-200 transition-all duration-300 ease-in-out"
    [class]="isSidebarOpen() ? 'w-64' : 'w-20'">
    
    <div class="flex items-center justify-center h-20 border-b border-gray-700">
      <h1 [class]="isSidebarOpen() ? 'text-2xl font-bold text-emerald-400' : 'hidden'">AgroSys</h1>
      <div [class]="isSidebarOpen() ? 'hidden' : 'text-emerald-400 text-3xl font-bold'">AS</div>
    </div>
    
    <nav class="flex-1 py-4 space-y-1 overflow-y-auto" [class]="isSidebarOpen() ? 'px-4' : 'px-3'">
      @for (module of currentSidebarModules(); track module.id) {
        @if (module.children) {
          <div class="relative group">
            <button (click)="toggleSubmenu(module.id)"
              class="w-full flex items-center justify-between py-2.5 rounded-lg cursor-pointer transition-colors duration-200"
              [class]="(isSidebarOpen() ? 'px-4 ' : 'justify-center ') + (isSubmenuActive(module) ? 'bg-gray-700 text-emerald-400' : 'hover:bg-gray-700')">
              <div class="flex items-center">
                <!-- Icons for submenus -->
                @switch (module.id) {
                    @case ('payroll-parameters-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg> }
                    @case ('personal-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 012-2h2a2 2 0 012 2v1m-4 0h4" /></svg> }
                    @case ('own-personnel-labor-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg> }
                    @case ('payroll-process-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h3m-3 0v-3m0 0h3m-6 0h3m-3 6h3m-6 0h3m-3 0h.01M12 3.055a9 9 0 100 17.89 9 9 0 000-17.89z" /></svg> }
                    @case ('settlements-process-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg> }
                    @case ('accounting-transfer-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg> }
                    @case ('month-end-closing-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2zM12 14l-2-2m0 0l2-2m-2 2h4" /></svg> }
                }
                <span class="font-medium whitespace-nowrap overflow-hidden transition-all duration-200 ease-in-out"
                  [class]="isSidebarOpen() ? 'max-w-xs ml-4' : 'max-w-0'">{{ module.name }}</span>
              </div>
              @if (isSidebarOpen()) {
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform duration-300" [class]="openSubmenuIds()[module.id] ? 'rotate-90' : ''" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                </svg>
              }
            </button>
            <div class="overflow-hidden transition-all duration-300 ease-in-out" [style.max-height.px]="openSubmenuIds()[module.id] ? 1500 : 0">
              <ul class="pt-1 space-y-1" [class]="isSidebarOpen() ? 'pl-4' : ''">
                @for(submodule of module.children; track submodule.id) {
                  <li>
                    <a (click)="selectModule(submodule.id, true)"
                      class="relative group flex items-center p-2 rounded-md cursor-pointer transition-colors duration-200"
                      [class]="(isSidebarOpen() ? 'pl-3' : 'justify-center ') + (selectedModuleId() === submodule.id ? 'bg-emerald-500 text-white shadow-md' : 'hover:bg-gray-700')">
                      <!-- Icons for leaf nodes -->
                       @if (!isSidebarOpen()) {
                        <span class="absolute left-full ml-3 w-auto p-2 min-w-max rounded-md shadow-md text-white bg-gray-900 border border-gray-700 text-xs font-bold transition-all duration-100 scale-0 origin-left group-hover:scale-100 z-50">
                          {{ submodule.name }}
                        </span>
                      }
                      <span class="text-sm font-medium whitespace-nowrap overflow-hidden transition-all duration-200 ease-in-out"
                        [class]="isSidebarOpen() ? 'max-w-xs' : 'max-w-0'">{{ submodule.name }}</span>
                    </a>
                  </li>
                }
              </ul>
            </div>
            @if (!isSidebarOpen()) {
               <span class="absolute left-full ml-3 w-auto p-2 min-w-max rounded-md shadow-md text-white bg-gray-900 border border-gray-700 text-xs font-bold transition-all duration-100 scale-0 origin-left group-hover:scale-100 z-50">
                  {{ module.name }}
                </span>
            }
          </div>
        } @else {
          <a (click)="selectModule(module.id, true)"
            class="relative group flex items-center py-2.5 rounded-lg cursor-pointer transition-colors duration-200"
            [class]="(isSidebarOpen() ? 'px-4 ' : 'justify-center ') + (selectedModuleId() === module.id ? 'bg-emerald-500 text-white shadow-lg' : 'hover:bg-gray-700')">
            @if (!isSidebarOpen()) {
              <span class="absolute left-full ml-3 w-auto p-2 min-w-max rounded-md shadow-md text-white bg-gray-900 border border-gray-700 text-xs font-bold transition-all duration-100 scale-0 origin-left group-hover:scale-100 z-50">
                {{ module.name }}
              </span>
            }
            <span class="font-medium whitespace-nowrap overflow-hidden transition-all duration-200 ease-in-out"
              [class]="isSidebarOpen() ? 'max-w-xs' : 'max-w-0'">{{ module.name }}</span>
          </a>
        }
      }
    </nav>
  </aside>

  <!-- Main content -->
  <div class="flex flex-col flex-1 overflow-hidden">
    <!-- Header -->
    <header class="flex items-center justify-between h-20 px-4 sm:px-6 bg-gray-800 border-b border-gray-700 relative z-10 shrink-0">
      <div class="flex items-center gap-4">
        <button (click)="toggleMobileMenu()" class="p-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 lg:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </button>
        <button (click)="toggleSidebar()" class="hidden lg:block p-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-emerald-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </button>
        <!-- Logo -->
        <button (click)="goToDashboard()" class="flex items-center gap-3 text-xl font-bold text-emerald-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-emerald-500 rounded-lg transition-transform duration-200 ease-in-out hover:scale-105">
          <div class="bg-gray-700/50 p-2 rounded-lg">
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-emerald-400">
              <path fill-rule="evenodd" d="M11.54 22.351l.07.04.028.016a.76.76 0 0 0 .723 0l.028-.015.071-.041a16.975 16.975 0 0 0 5.424-4.271l1.178-1.177a.75.75 0 0 0-1.06-1.06l-1.177 1.177a15.475 15.475 0 0 1-4.662 3.725V16.5a.75.75 0 0 0-1.5 0v3.088a15.475 15.475 0 0 1-4.662-3.725l-1.177-1.177a.75.75 0 0 0-1.06 1.06l1.177 1.177a16.975 16.975 0 0 0 5.424 4.271ZM12 4.5a.75.75 0 0 1 .75.75v8.25a.75.75 0 0 1-1.5 0V5.25A.75.75 0 0 1 12 4.5Z" clip-rule="evenodd" />
            </svg>
          </div>
          <span class="hidden sm:inline">AgroSys</span>
        </button>
      </div>
      <div class="flex items-center gap-4">
        <!-- Company Selector, Indicators, User Menu... -->
        <div class="flex items-center gap-4">
          <!-- Company Selector -->
        <div class="relative">
          <button (click)="toggleCompanyDropdown()" class="flex items-center gap-2 p-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-emerald-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M5 13h14M5 17h14M5 9h14" /></svg>
            <span class="font-medium hidden sm:block">{{ selectedCompany().name }}</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
          </button>
          @if (isCompanyDropdownOpen()) {
            <div class="absolute mt-2 w-64 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1 right-0 z-20">
              @for (company of availableCompanies(); track company.id) {
                <a (click)="selectCompany(company)" class="flex items-center gap-3 px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white cursor-pointer">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M5 13h14M5 17h14M5 9h14" /></svg>
                  {{ company.name }}
                </a>
              }
            </div>
          }
        </div>
        <!-- Economic Indicators -->
        <div class="hidden md:flex items-center gap-4 text-sm border-l border-r border-gray-700 px-4">
          <div class="flex items-center gap-2">
            <span class="font-bold text-gray-400">UF:</span>
            <span>{{ economicIndicators().uf }}</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="font-bold text-gray-400">Dólar:</span>
            <span>{{ economicIndicators().dolar }}</span>
          </div>
        </div>
        
        <!-- User Menu -->
        <div class="relative">
          <button (click)="toggleUserDropdown()" class="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-emerald-500">
            <img class="w-10 h-10 rounded-full" [src]="currentUser().avatar" alt="Admin avatar">
            <div class="hidden md:flex flex-col items-start">
              <span class="font-medium text-sm">{{ currentUser().name }}</span>
              <span class="text-xs text-gray-400">Administrador</span>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 hidden md:block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
          </button>
          
          @if (isUserDropdownOpen()) {
            <div class="absolute right-0 mt-2 w-48 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1 z-20">
              <a href="#" class="flex items-center gap-3 px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                Mi Perfil
              </a>
              <a href="#" class="flex items-center gap-3 px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                Cerrar Sesión
              </a>
            </div>
          }
        </div>
      </div>
      </div>
    </header>

    <!-- Top Navigation (Desktop) -->
    <nav class="hidden lg:flex bg-gray-800 border-b border-gray-700 items-center overflow-x-auto relative z-0 shrink-0">
      <div class="flex px-4">
        @for(topModule of modules; track topModule.id) {
          <button (click)="selectTopModule(topModule.id)" 
                  class="flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors duration-200 whitespace-nowrap"
                  [class]="selectedTopModuleId() === topModule.id ? 'border-emerald-400 text-emerald-400' : 'border-transparent text-gray-400 hover:text-white'">
            <!-- Icons for top menu -->
            @switch (topModule.id) {
                @case ('dashboard-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg> }
                @case ('warehouses-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-2m-4-1v8m0 0l3-3m-3 3L9 8m-5 5h2.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293h3.172a1 1 0 00.707-.293l2.414-2.414a1 1 0 01.707-.293H20" /></svg> }
                @case ('purchase-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg> }
                @case ('machinery-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 13v-2a2 2 0 00-2-2H7a2 2 0 00-2 2v2m14 0h-1m-1 0H7m12 0v5a2 2 0 01-2 2H7a2 2 0 01-2-2v-5m14 0V9a2 2 0 00-2-2h-3l-2-3H9L7 7H5a2 2 0 00-2 2v2" /><circle cx="7" cy="17" r="2" /><circle cx="17" cy="17" r="2" /></svg> }
                @case ('accounting-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h3m-3 0v-3m0 0h3m-6 0h3m-3 6h3m-6 0h3m-3 0h.01M12 3.055a9 9 0 100 17.89 9 9 0 000-17.89z" /></svg> }
                @case ('payroll-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.975 5.975 0 0112 13a5.975 5.975 0 013 1.803M15 21a9 9 0 00-9-9" /></svg> }
                @case ('plant-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg> }
                @case ('exports-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2h10a2 2 0 002-2v-1a2 2 0 012-2h1.945M7.707 4.293l4.5-4.5a1 1 0 011.414 0l4.5 4.5M12 12v9" /></svg> }
                @case ('budget') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6-6" /></svg> }
                @case ('contractors-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg> }
                @case ('bpa-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> }
                @case ('users-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg> }
                @case ('parameters-group') { <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg> }
            }
             {{ topModule.name }}
          </button>
        }
      </div>
    </nav>


    <!-- Content Area -->
    <main class="flex-1 p-4 sm:p-6 overflow-y-auto bg-gray-900">
      @switch (selectedModuleId()) {
        @case ('dashboard-overview') { <app-dashboard></app-dashboard> }
        @case ('seasons') { <app-seasons></app-seasons> }
        @case ('group-cost-center-reports') { <app-group-cost-center-reports></app-group-cost-center-reports> }
        @case ('maintain-kg-boxes-by-cc') { <app-maintain-kg-boxes-by-cc></app-maintain-kg-boxes-by-cc> }
        @case ('load-budget-from-excel') { <app-load-budget-from-excel></app-load-budget-from-excel> }
        @case ('maintain-season-budget') { <app-maintain-season-budget></app-maintain-season-budget> }
        @case ('season-budget-report') { <app-season-budget-report></app-season-budget-report> }
        @case ('season-cost-report') { <app-season-cost-report></app-season-cost-report> }
        @case ('cost-table') { <app-cost-table></app-cost-table> }
        @case ('budget-vs-cost-table') { <app-budget-vs-cost-table></app-budget-vs-cost-table> }
        @case ('budgetary-control') { <app-budgetary-control></app-budgetary-control> }
        @case ('warehouse-summary') { <app-warehouses></app-warehouses> }
        @case ('warehouse-parameters') { <app-warehouse-parameters></app-warehouse-parameters> }
        @case ('warehouse-movements') { <app-warehouse-movements></app-warehouse-movements> }
        @case ('warehouse-reports') { <app-warehouse-reports></app-warehouse-reports> }
        @case ('warehouse-accounting-transfer') { <app-warehouse-accounting-transfer></app-warehouse-accounting-transfer> }
        @case ('warehouse-month-end-closing') { <app-warehouse-month-end-closing></app-warehouse-month-end-closing> }
        @case ('purchase-parameters') { <app-purchase-parameters></app-purchase-parameters> }
        @case ('purchase-request') { <app-purchase-request></app-purchase-request> }
        @case ('purchase-request-report') { <app-purchase-request-report></app-purchase-request-report> }
        @case ('purchase-order') { <app-purchase-orders></app-purchase-orders> }
        @case ('purchase-order-report') { <app-purchase-order-report></app-purchase-order-report> }
        @case ('close-reactivate-po') { <app-close-reactivate-po></app-close-reactivate-po> }
        @case ('purchase-order-approval') { <app-purchase-order-approval></app-purchase-order-approval> }
        @case ('po-service-reception') { <app-po-service-reception></app-po-service-reception> }
        @case ('department-user-report') { <app-department-user-report></app-department-user-report> }
        @case ('pending-po-report') { <app-pending-po-report></app-pending-po-report> }
        @case ('supplier-product-price-report') { <app-supplier-product-price-report></app-supplier-product-price-report> }
        @case ('cost-center-distribution-report') { <app-cost-center-distribution-report></app-cost-center-distribution-report> }
        @case ('machinery-summary') { <app-machinery></app-machinery> }
        @case ('machinery-parameters') { <app-machinery-parameters></app-machinery-parameters> }
        @case ('daily-machinery-log') { <app-daily-machinery-log></app-daily-machinery-log> }
        @case ('other-proratable-values') { <app-other-proratable-values></app-other-proratable-values> }
        @case ('proratable-values-report') { <app-proratable-values-report></app-proratable-values-report> }
        @case ('monthly-proration') { <app-monthly-proration></app-monthly-proration> }
        @case ('machinery-reports') { <app-machinery-reports></app-machinery-reports> }
        @case ('machinery-accounting-transfer') { <app-machinery-accounting-transfer></app-machinery-accounting-transfer> }
        @case ('accounting-summary') { <app-accounting></app-accounting> }
        @case ('providers') { <app-providers></app-providers> }
        @case ('sales') { <app-sales></app-sales> }
        @case ('treasury') { <app-treasury></app-treasury> }
        @case ('fixed-assets') { <app-fixed-assets></app-fixed-assets> }
        @case ('payroll-activities') { <app-payroll-activities></app-payroll-activities> }
        @case ('general-tables') { <app-general-tables></app-general-tables> }
        @case ('assets-discounts') { <app-assets-discounts></app-assets-discounts> }
        @case ('settlement-parameters') { <app-settlement-parameters></app-settlement-parameters> }
        @case ('company-settlement-parameters') { <app-company-settlement-parameters></app-company-settlement-parameters> }
        @case ('unique-tax') { <app-unique-tax></app-unique-tax> }
        @case ('farms') { <app-farms></app-farms> }
        @case ('labor') { <app-labor></app-labor> }
        @case ('labor-activity') { <app-labor-activity></app-labor-activity> }
        @case ('control-units') { <app-control-units></app-control-units> }
        @case ('legal-representative') { <app-legal-representative></app-legal-representative> }
        @case ('farm-user-permissions') { <app-farm-user-permissions></app-farm-user-permissions> }
        @case ('labor-assets-discounts-association') { <app-labor-assets-discounts-association></app-labor-assets-discounts-association> }
        @case ('weekly-schedule') { <app-weekly-schedule></app-weekly-schedule> }
        @case ('afp') { <app-afp></app-afp> }
        @case ('health') { <app-health></app-health> }
        @case ('provident-funds') { <app-provident-funds></app-provident-funds> }
        @case ('bank') { <app-bank></app-bank> }
        @case ('payment-methods') { <app-payment-methods></app-payment-methods> }
        @case ('responsibility-center') { <app-responsibility-center></app-responsibility-center> }
        @case ('crew-boss') { <app-crew-boss></app-crew-boss> }
        @case ('tasks') { <app-tasks></app-tasks> }
        @case ('holidays') { <app-holidays></app-holidays> }
        @case ('accounting-parameters') { <app-accounting-parameters></app-accounting-parameters> }
        @case ('electronic-book-parameters') { <app-electronic-book-parameters></app-electronic-book-parameters> }
        @case ('personal-file') { <app-personal-file></app-personal-file> }
        @case ('own-personnel-labor') { <app-own-personnel-labor></app-own-personnel-labor> }
        @case ('payroll-process') { <app-payroll-process></app-payroll-process> }
        @case ('settlements-process') { <app-settlements-process></app-settlements-process> }
        @case ('accounting-transfer') { <app-accounting-transfer-process></app-accounting-transfer-process> }
        @case ('month-end-closing') { <app-month-end-closing-process></app-month-end-closing-process> }
        @case ('plant-summary') { <app-plant></app-plant> }
        @case ('plant-parameters') { <app-plant-parameters></app-plant-parameters> }
        @case ('bulk-fruit') { <app-bulk-fruit></app-bulk-fruit> }
        @case ('packing') { <app-packing></app-packing> }
        @case ('cold-storage') { <app-cold-storage></app-cold-storage> }
        @case ('quality-control') { <app-quality-control></app-quality-control> }
        @case ('packaging-control') { <app-packaging-control></app-packaging-control> }
        @case ('exports-summary') { <app-exports></app-exports> }
        @case ('export-parameters') { <app-export-parameters></app-export-parameters> }
        @case ('scheduling') { <app-scheduling></app-scheduling> }
        @case ('shipment') { <app-shipment></app-shipment> }
        @case ('valuation') { <app-valuation></app-valuation> }
        @case ('commercial-management-account') { <app-commercial-management-account></app-commercial-management-account> }
        @case ('budget') { <app-budget></app-budget> }
        @case ('contractor-summary') { <app-contractors></app-contractors> }
        @case ('contractor-parameters') { <app-contractor-parameters></app-contractor-parameters> }
        @case ('contractor-file') { <app-contractor-file></app-contractor-file> }
        @case ('contract-entry') { <app-contract-entry></app-contract-entry> }
        @case ('personnel-enrollment') { <app-personnel-enrollment></app-personnel-enrollment> }
        @case ('personnel-attendance') { <app-personnel-attendance></app-personnel-attendance> }
        @case ('attendance-report') { <app-attendance-report></app-attendance-report> }
        @case ('agromovil') { <app-agromovil></app-agromovil> }
        @case ('production-control') { <app-production-control></app-production-control> }
        @case ('contractor-production-report') { <app-contractor-production-report></app-contractor-production-report> }
        @case ('contractor-cost-report') { <app-contractor-cost-report></app-contractor-cost-report> }
        @case ('contractor-revaluation') { <app-contractor-revaluation></app-contractor-revaluation> }
        @case ('contractor-proforma-invoice') { <app-contractor-proforma-invoice></app-contractor-proforma-invoice> }
        @case ('contractor-month-end-closing') { <app-contractor-month-end-closing></app-contractor-month-end-closing> }
        @case ('bpa-summary') { <app-bpa></app-bpa> }
        @case ('bpa-parameters') { <app-bpa-parameters></app-bpa-parameters> }
        @case ('application-order-planning') { <app-application-order-planning></app-application-order-planning> }
        @case ('application-order-execution') { <app-application-order-execution></app-application-order-execution> }
        @case ('orders-calendar') { <app-orders-calendar></app-orders-calendar> }
        @case ('close-orders') { <app-close-orders></app-close-orders> }
        @case ('bpa-reports') { <app-bpa-reports></app-bpa-reports> }
        @case ('profile-type') { <app-profile-type></app-profile-type> }
        @case ('profiles') { <app-profiles></app-profiles> }
        @case ('accounts') { <app-users></app-users> }
        @case ('general-parameters') { <app-parameters></app-parameters> }
        @case ('companies') { <app-companies></app-companies> }
        @case ('species-variety') { <app-species-variety></app-species-variety> }
        @case ('general-farms') { <app-general-farms></app-general-farms> }
        @case ('land-types') { <app-land-types></app-land-types> }
        @case ('cost-centers') { <app-cost-centers></app-cost-centers> }
        @case ('geographic-location') { <app-geographic-location></app-geographic-location> }
        @case ('financial-indicators') { <app-financial-indicators></app-financial-indicators> }
        @default { <app-dashboard></app-dashboard> }
      }
    </main>
  </div>
</div>